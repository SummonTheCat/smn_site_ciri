<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Set Service Key</title>
  <link rel="stylesheet" href="./styles-elements.css">
  <link rel="stylesheet" href="./styles.css">

  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Funnel+Display:wght@300..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
</head>

<body>
  <div class="msg-box">
    <div class="space-medium"></div>

    <div class="flex-row">
      <h1>Configure Service Key</h1>
    </div>

    <div class="space-medium"></div>

    <div class="flex-row">
      <p>Enter your service key to enable file operations:</p>
    </div>

    <div class="space-small"></div>

    <div class="flex-row">
      <input type="password" id="keyInput" placeholder="Service Key" size="30">
    </div>

    <div class="space-small"></div>

    <div class="flex-row">
      <button id="saveBtn">Save Key</button>
    </div>

    <div class="space-small"></div>

    <div class="flex-row">
      <p id="status">Waiting for auth key...</p>
    </div>

    <div class="space-medium"></div>

    <script>
      // Monkeyâ€‘patch fetch to add x-service-key header
      (function () {
        const orig = window.fetch;
        window.fetch = (input, init = {}) => {
          init.headers = init.headers || {};
          const key = localStorage.getItem('serviceKey');
          if (key) {
            init.headers['x-service-key'] = key;
          }
          return orig(input, init);
        };
      })();

      // UI logic
      const input = document.getElementById('keyInput');
      const btn = document.getElementById('saveBtn');
      const status = document.getElementById('status');

      // preload
      input.value = localStorage.getItem('serviceKey') || '';

      btn.onclick = () => {
        const v = input.value.trim();
        if (!v) {
          status.textContent = 'Key cannot be empty.';
          // Add class for error styling
          status.style.color = 'var(--color-status-error)';
          return;
        }
        localStorage.setItem('serviceKey', v);
        status.textContent = 'Saved!';
        // Add class for success styling
        status.style.color = 'var(--color-status-success)';
      };
    </script>
</body>

</html>