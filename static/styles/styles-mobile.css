/* ===========================
   Mobile-only responsive layer
   (append to end of stylesheet)
   =========================== */

@media (max-width: 768px) {
  /* Use modern viewport units on mobile so bg covers visible area */
  .fullscreen {
    /* keep your existing desktop rules intact; just refine for mobile */
    width: 100vw;
    min-height: 100vh; /* fallback if svh/dvh unsupported */
    object-position: center 40%; /* tweak as needed for focal point */
    transform: scale(1.025);     /* slight scale to hide blur edge */
  }

  /* Prefer svh/dvh on supporting browsers (inside mobile only) */
  @supports (height: 100svh) {
    .fullscreen {
      height: 100svh;
      min-height: 100svh;
    }
  }
  @supports (height: 100dvh) {
    .fullscreen {
      height: 100dvh;
      min-height: 100dvh;
    }
  }

  /* Reduce blur / increase darken for readability on small screens */
  :root {
    --blur-radius: 16px;
    --darken-amount: 0.45;

    /* tighten spacing a touch on mobile */
    --buffer-small: 0.45em;
    --buffer-medium: 0.8em;
    --buffer-large: 1.4em;
  }

  /* Keep combined filter authoritative (mobile only) */
  .blur-01.darken-01 {
    filter: blur(var(--blur-radius, 16px)) brightness(var(--darken-amount, 0.45));
  }

  /* Prevent horizontal scroll from long words/links */
  html, body { overflow-x: hidden; }

  /* Safe-area padding for notches/home indicators */
  body {
    padding-left: max(env(safe-area-inset-left), 0px);
    padding-right: max(env(safe-area-inset-right), 0px);
    padding-top: max(env(safe-area-inset-top), 0px);
    padding-bottom: max(env(safe-area-inset-bottom), 0px);
  }

  /* Fluid type on mobile only */
  :root {
    --fluid-step: clamp(0.95rem, 0.9rem + 0.8vw, 1.1rem);
    --fluid-h1: clamp(1.25rem, 1.05rem + 2vw, 1.75rem);
    --fluid-h2: clamp(1.1rem, 0.95rem + 1.4vw, 1.4rem);
  }
  body { font-size: var(--fluid-step); }
  h1 { font-size: var(--fluid-h1); }
  h2 { font-size: var(--fluid-h2); }

  /* Touch targets & link comfort */
  a, button {
    min-height: 44px;
    display: inline-flex;
    align-items: center;
  }
  a {
    padding: 6px 10px;
    text-decoration-thickness: 0.06em;
    text-underline-offset: 0.18em;
  }

  /* Header can grow naturally with text */
  header {
    height: auto;
    padding: calc(var(--buffer-small) + 2px) var(--buffer-medium);
    gap: var(--buffer-small);
  }

  /* Content container sizing */
  .msg-box {
    max-width: min(92vw, 520px);
    margin: clamp(8px, 2.5vh, 20px) auto;
    padding: var(--buffer-medium);
  }

  .container-inset {
    padding: clamp(12px, 2.5vw, var(--buffer-large));
  }

  /* Rows wrap nicely on narrow screens */
  .flex-row { flex-wrap: wrap; }
  .nav-buttons { gap: clamp(6px, 1.8vw, var(--buffer-medium)); }

  /* Scaled spacing utilities */
  .space-large { width: var(--buffer-large); height: var(--buffer-large); }
  .space-medium { width: var(--buffer-medium); height: var(--buffer-medium); }
  .space-small { width: var(--buffer-small); height: var(--buffer-small); }

  /* Slightly bias vertical centering on short viewports */
  .flex-center { align-items: flex-start !important; }
}

/* Extra-small phones */
@media (max-width: 380px) {
  .msg-box { max-width: 94vw; }
  header h1 { font-size: clamp(1.05rem, 2vw + 0.9rem, 1.25rem); }
  .container-inset { padding: 12px; }
}

/* ================================
   iOS Safari: fixed background fix
   (append to end of stylesheet)
   ================================ */
@supports (-webkit-touch-callout: none) {
  /* Make sure the page height is based on the *visible* viewport */
  body {
    min-height: 100dvh;
    height: auto;            /* avoid locking to legacy 100vh */
    overflow-x: hidden;
  }

  /* Ensure your actual content sits above the bg image */
  header, main, footer {
    position: relative;      /* create stacking context */
    z-index: 1;
  }

  /* Keep the transition overlay on top when used */
  #page-transition-overlay {
    position: fixed;
    z-index: 2147483647;
  }

  /* Put the background firmly *behind* everything, sized to the dynamic viewport */
  .fullscreen {
    position: fixed;
    top: 0; right: 0; bottom: 0; left: 0; /* equivalent to inset: 0; avoids height:auto ambiguity */
    width: 100vw;
    height: 100dvh;          /* dynamic viewport fixes Safari address bar issues */
    min-height: 100dvh;
    object-fit: cover;
    object-position: center; /* tweak if you want a different focal point */
    z-index: -1;
    pointer-events: none;

    /* Force its own compositing layer; helps Safari z-index/rendering glitches */
    transform: translateZ(0) scale(1.025);
  }

  /* If you’re blurring/darkening, keep the combined filter authoritative */
  .blur-01.darken-01 {
    filter: blur(var(--blur-radius, 16px)) brightness(var(--darken-amount, 0.45));
  }
}













/* ==========================================================================
   Mobile Overrides & Topbar Drawer
   Target file: /styles/styles-mobile.css
   Relies only on variables defined in styles-base.css
   ========================================================================== */

/* ---------- Base tweaks that make sense on small screens ---------- */
@media (max-width: 1024px) {
  /* Sidebar becomes a top drawer */
  .sidebar {
    position: fixed;
    top: var(--header-height, 56px);
    left: 0;
    right: 0;
    width: 100vw;
    height: calc(100vh - var(--header-height, 56px));
    overflow: auto;
    border-right: none;
    border-bottom: 1px solid var(--color-secondary-02);
    background: var(--color-accent-02);
    transform: translateY(-100%);
    transition: transform var(--transition-speed) ease;
    padding: var(--buffer-medium);
  }

  .sidebar.open {
    transform: translateY(0) !important;  /* slide down when open */
  }

  /* Content no longer offset by desktop sidebar */
  .content {
    margin-left: 0;
    padding: var(--buffer-medium);
    min-height: 100vh;
  }

  .content-wrapper {
    width: 100%;
    max-width: var(--content-width-max);
    margin: 0 auto;
    border-radius: var(--border-radius);
  }

  /* Project list items: good tap targets */
  .project-link {
    padding: calc(var(--buffer-small) * 1.25) var(--buffer-medium);
    border-radius: var(--border-radius);
  }

  /* Media grids: compress columns gracefully */
  .video-grid,
  .image-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--buffer-medium);
  }
}

@media (max-width: 640px) {
  .video-grid,
  .image-grid {
    grid-template-columns: 1fr;
  }

  .meta-grid {
    grid-template-columns: 1fr;
  }

  .section-title {
    margin-bottom: var(--buffer-small);
  }
}

/* ---------- Mobile Top Bar (drawer handle) ---------- */
/* Add this small bar to your template for mobile:
    <label for="nav-toggle" class="mobile-topbar" aria-controls="sidebar" aria-expanded="false">
      <button class="mobile-topbar__btn" type="button" aria-hidden="true">☰ Menu</button>
      <span class="mobile-topbar__title">Projects</span>
    </label>
    <input type="checkbox" id="nav-toggle" class="nav-toggle" hidden>
    <label for="nav-toggle" class="mobile-scrim" aria-hidden="true"></label>
   Or toggle `body.sidebar-open` from JS instead of using the checkbox.
*/
@media (max-width: 1024px) {
  /* Hide any large desktop header if you want—adjust to your markup */
  header.nav-buttons {
    display: none;
  }

  .mobile-topbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height, 56px);
    display: flex;
    align-items: center;
    gap: var(--buffer-small);
    padding: 0 var(--buffer-medium);
    background: var(--color-accent-01);
    border-bottom: 1px solid var(--color-secondary-02);
    z-index: 40; /* above sidebar */
    color: var(--color-primary-01);
  }

  .mobile-topbar__btn {
    appearance: none;
    margin: 0;
    padding: 8px 12px;
    background: var(--color-accent-02);
    color: var(--color-primary-02);
    border: var(--border-width) solid var(--color-secondary-02);
    border-radius: var(--border-radius);
    font-weight: 700;
    cursor: pointer;
    transition: background var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed);
  }
  .mobile-topbar__btn:hover {
    background: var(--color-primary-02);
    color: var(--color-accent-02);
    border-color: var(--color-accent-02);
  }

  .mobile-topbar__title {
    font-family: var(--font-family-heading);
    font-size: var(--font-size-medium);
    color: var(--color-primary-01);
  }

  /* Make room for the topbar */
  .root {
    padding-top: var(--header-height, 56px);
  }
}

/* ---------- Force Hide Mobile Features on Desktop ---------- */
@media (min-width: 1025px) {
  .mobile-scrim {
    display: none;
  }
  .mobile-topbar {
    display: none;
  }
  .mobile-scrim {
    display: none;
  }
}

/* ---------- Open/Close Mechanics ---------- */
/* Option A: JS toggles `body.sidebar-open` */
@media (max-width: 1024px) {
 
  body.sidebar-open .mobile-scrim {
    opacity: 1;
    visibility: visible;
  }

  .mobile-scrim {
    position: fixed;
    inset: var(--header-height, 56px) 0 0 0; /* below the topbar */
    background: rgba(0,0,0,0.45);
    z-index: 35;
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--transition-speed) ease;
  }

  .content-wrapper {
    width: 100% !important; /* full width when sidebar is open */
  }

  .content {
    width: 100% !important; /* full width when sidebar is open */
    margin-left: 0 !important;

  }

  .sidebar {
    z-index: 30; /* above content, below scrim */
    width: 100vw !important; /* full width when sidebar is open */
    height: 100vh !important; /* full height when sidebar is open */
  }

}

/* Option B: Checkbox hack—no JS required */
@media (max-width: 1024px) {
  .nav-toggle:checked ~ .mobile-scrim {
    opacity: 1;
    visibility: visible;
  }
}

/* ---------- Nice-to-haves on touch screens ---------- */
@media (hover: none) and (pointer: coarse) {
  .project-link {
    /* slightly larger hit area on touch */
    padding: calc(var(--buffer-small) * 1.4) var(--buffer-medium);
  }
  .video-item,
  .image-item {
    border-radius: calc(var(--border-radius) * 1.25);
  }
}

/* ---------- Safe area (notch) padding on iOS ---------- */
@supports (padding: max(0px)) {
  @media (max-width: 1024px) {
    .mobile-topbar {
      padding-left: max(var(--buffer-medium), env(safe-area-inset-left));
      padding-right: max(var(--buffer-medium), env(safe-area-inset-right));
      padding-top: max(0px, env(safe-area-inset-top));
      height: calc(var(--header-height, 56px) + env(safe-area-inset-top));
    }
    .root {
      padding-top: calc(var(--header-height, 56px) + env(safe-area-inset-top));
    }
    .sidebar {
      height: calc(100vh - (var(--header-height, 56px) + env(safe-area-inset-top)));
    }
    .mobile-scrim {
      inset: calc(var(--header-height, 56px) + env(safe-area-inset-top)) 0 0 0;
    }
  }
}
